#!/usr/bin/env ruby

lib = File.expand_path(File.dirname(__FILE__) + '/../lib')
$LOAD_PATH.unshift(lib) if File.directory?(lib) && !$LOAD_PATH.include?(lib)

require "apocalypse-reporter"
require 'trollop'

SUB_COMMANDS = %w(report install check)

global_opts = Trollop::options do
  banner "Apocalypse Reporter"
  stop_on SUB_COMMANDS
end

cmd = ARGV.shift
cmd_opts = case cmd
  when "report"
    Trollop::options do
      opt :server,  "Hostname of the Apocalypse Server", :type => :string, :short => "-s"
      opt :port,    "Port the Apocalypse Server is listening on. Default: 80", :type => :string, :default => '80', :short => "-p"
      opt :hostid,  "Identifier for this server", :type => :string, :short => "-i"
    end
  when "install"
    Trollop::options do
      # TODO
    end
  when "check"
    Trollop::options do
      # TODO
    end
  else
    Trollop::die "unknown command #{cmd.inspect}"
  end

reporter = Apocalypse::Client.new
reporter.send(cmd, cmd_opts)
